<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Stream TV Compatibilidade Total</title>
    <style type="text/css">
        body { background-color: #000; color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 20px; text-align: center; }
        .grade { display: block; width: 100%; margin-top: 40px; }
        .card {
            display: inline-block; width: 180px; margin: 10px;
            background: #1a1a1a; border: 4px solid #333; vertical-align: top;
            outline: none; text-decoration: none; color: white; border-radius: 5px;
        }
        .card:focus { border-color: #e50914; transform: scale(1.05); }
        .card img { width: 100%; height: 250px; display: block; background: #222; }
        .card-title { padding: 8px; font-size: 14px; font-weight: bold; height: 35px; overflow: hidden; }
        #debug { position: fixed; bottom: 0; left: 0; background: rgba(255,0,0,0.7); font-size: 12px; padding: 4px; }
        #player { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; }
    </style>
</head>
<body onload="carregarTV()">

    <div id="debug">Status: Inicializando...</div>
    <h1 style="color:#e50914">MEU STREAMING</h1>
    
    <div id="lista" class="grade">
        <h2>A carregar lista de filmes...</h2>
    </div>

    <div id="player">
        <video id="vid" width="100%" height="100%" controls autoplay></video>
    </div>

    <script type="text/javascript">
        // ATENÇÃO: Substituímos o Firebase por uma chamada direta via API REST
        // Isso ignora as bibliotecas pesadas que a TV não suporta
        var projetoID = "meuappstreaming-b615b";
        var urlAPI = "https://firestore.googleapis.com/v1/projects/" + projetoID + "/databases/(default)/documents/filmes";

        function carregarTV() {
            var container = document.getElementById('lista');
            var dbg = document.getElementById('debug');

            // Chamada ultra-compatível que toda Smart TV entende
            fetch(urlAPI)
                .then(function(response) { return response.json(); })
                .then(function(json) {
                    if (!json.documents) {
                        dbg.innerHTML = "Erro: Banco vazio ou URL errada";
                        container.innerHTML = "<h3>Adicione filmes no Admin primeiro!</h3>";
                        return;
                    }

                    var html = "";
                    for (var i = 0; i < json.documents.length; i++) {
                        var doc = json.documents[i].fields;
                        // O Firebase REST API entrega os dados de um jeito diferente:
                        var titulo = doc.titulo.stringValue;
                        var capa = doc.capa.stringValue;
                        var video = doc.video.stringValue;

                        html += '<a href="#" class="card f-item" onclick="play(\''+video+'\'); return false;">';
                        html += '<img src="'+capa+'" border="0">';
                        html += '<div class="card-title">'+titulo+'</div></a>';
                    }

                    container.innerHTML = html;
                    dbg.innerHTML = "Sucesso: Filmes carregados via REST API";

                    // Foco automático para o comando
                    setTimeout(function() {
                        var itens = document.getElementsByClassName('f-item');
                        if(itens[0]) itens[0].focus();
                    }, 1000);
                })
                .catch(function(err) {
                    dbg.innerHTML = "Erro de Rede: " + err.message;
                    container.innerHTML = "<h3>Erro ao ligar ao servidor.</h3>";
                });
        }

        function play(link) {
            document.getElementById('player').style.display = 'block';
            var v = document.getElementById('vid');
            v.src = link;
            v.play();
        }

        document.onkeydown = function(e) {
            var k = e.keyCode;
            if (k == 13 || k == 29443) { // OK
                var act = document.activeElement;
                if(act && act.onclick) act.onclick();
            }
            if (k == 8 || k == 461 || k == 27 || k == 10009) { // VOLTAR
                document.getElementById('vid').pause();
                document.getElementById('player').style.display = 'none';
            }
        };
    </script>
</body>
</html>

